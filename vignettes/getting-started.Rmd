---
title: "Getting Started with qctools"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{getting-started}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, echo=FALSE}
options(rmarkdown.html_vignette.check_title = FALSE)
library(DT)
```

# Introduction

`qctools` is a toolkit for managing the quality control (QC) process for scripts. It tracks the assignment, review, and acceptance of scripts using a centralized log file, **`QClog.csv`**. This log ensures that every script is reviewed systematically, with clear records of modifications and approvals.

By integrating with Git, `qctools` automatically detects when a script has been modified and flags it for re-evaluation. It provides functions to assign reviewers, check pending work, and summarize the QC status of all scripts.

The core functions of `qctools` are:
- **`logCreate()`**: Creates the QC log.
- **`logAssign()`**: Assigns scripts to reviewers for QC.
- **`logAccept()`**: Marks scripts as reviewed and accepted.
- **`logPending()`**: Lists scripts that still need QC.
- **`logSummary()`**: Provides a high-level summary of the QC status of all scripts.

# Core Functions

## `logCreate()`
The first step is to create the QC log file using `logCreate()`:

```{r eval=FALSE}
library(qctools)
logCreate()
```

### Example Log (Pre-existing)
For demonstration, assume the `QClog.csv` already contains some entries. Below is the initial log:

```{r, echo=FALSE}
log <- data.frame(
  file = c("script/analysis.R", "script/data-prep.R", "script/model-fitting.R", "script/visualize.R"),
  commit = c("Initial-Assignment", "abc1234", "Initial-Assignment", "def5678"),
  reviewer = c("Jane Doe", "John Smith", "Alice Johnson", "Bob Miller"),
  datetime = c("2024-11-19 10:00:00", "2024-11-19 11:30:00", "2024-11-19 12:00:00", "2024-11-19 13:00:00")
)
datatable(log, rownames = FALSE, options = list(dom = 't'))
```

## `logAssign()`
Assigns a file for QC, optionally specifying a reviewer.

### Example:
Suppose we assign `script/model-fitting.R` to `Alice Johnson` for QC. Below is the code for this operation and the updated log:

```{r eval=FALSE}
logAssign(file = "script/model-fitting.R", reviewer = "Alice Johnson")
```

```{r, echo=FALSE}
log <- log[log$file != "script/model-fitting.R", ]  # Remove duplicate if exists
log <- rbind(log, data.frame(
  file = "script/model-fitting.R",
  commit = "Initial-Assignment",
  reviewer = "Alice Johnson",
  datetime = "2024-11-19 14:00:00"
))
datatable(
  log,
  rownames = FALSE,
  options = list(dom = 't')
) %>%
  formatStyle(
    'file',
    target = 'row',
    backgroundColor = styleEqual("script/model-fitting.R", "#ffff99")
  )
```

## `logAccept()`
Marks a file as accepted after review, recording the latest commit and reviewer details.

### Example:
Suppose `script/model-fitting.R` is reviewed and accepted by `Alice Johnson`. The log now reflects the acceptance:

```{r eval=FALSE}
logAccept(file = "script/model-fitting.R")
```

```{r, echo=FALSE}
log <- rbind(log, data.frame(
  file = "script/model-fitting.R",
  commit = "def5678",
  reviewer = "Alice Johnson",
  datetime = "2024-11-19 15:00:00"
))
datatable(
  log,
  rownames = FALSE,
  options = list(dom = 't')
) %>%
  formatStyle(
    'file',
    target = 'row',
    backgroundColor = styleEqual("script/model-fitting.R", "#c7e9c0")
  )
```

## `logPending()`
Lists files that require QC because they are either:
1. Assigned but not yet reviewed.
2. Modified since the last QC.

### Example:
Here are the files still pending QC:

```{r, echo=FALSE}
pending <- data.frame(
  file = c("script/analysis.R"),
  last_author = c("Bob Miller"),
  reviewer = c("Jane Doe"),
  datetime = c("2024-11-19 10:00:00")
)
datatable(pending, rownames = FALSE, options = list(dom = 't'))
```

## `logSummary()`
Provides a summary of the QC status of all files in the log.

### Example:
Here is the summary of the QC status:

```{r, echo=FALSE}
summary <- data.frame(
  file = c("script/analysis.R", "script/data-prep.R", "script/model-fitting.R", "script/visualize.R"),
  status = c("Modified - needs QC", "Fully QCed", "Fully QCed", "Fully QCed")
)
datatable(summary, rownames = FALSE, options = list(dom = 't'))
```

# Workflow Example

1. Create the log:
   ```{r eval=FALSE}
   logCreate()
   ```

2. Assign files for review:
   ```{r eval=FALSE}
   logAssign(file = "script/model-fitting.R", reviewer = "Alice Johnson")
   ```

3. Mark files as accepted after review:
   ```{r eval=FALSE}
   logAccept(file = "script/model-fitting.R")
   ```

4. Check pending files:
   ```{r eval=FALSE}
   logPending()
   ```

5. View a summary of the QC process:
   ```{r eval=FALSE}
   logSummary()
   ```

# Further Resources

For more information, refer to the package documentation or other vignettes.
